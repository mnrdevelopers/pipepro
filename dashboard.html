<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | PipePro</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="logo.png" type="image/png">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <button class="btn btn-link text-dark me-3 d-lg-none" id="sidebarToggle">
                <i class="fas fa-bars fa-lg"></i>
            </button>
            
            <a class="navbar-brand" href="#" onclick="window.navigateToSection('dashboard'); return false;">
                <img src="logo.png" alt="Logo" width="40" height="40" class="d-inline-block align-text-top me-2">
                <span>PipePro</span>
            </a>
            
            <div class="d-flex align-items-center ms-auto">
                <!-- Notifications -->
                <div class="dropdown me-3">
                    <button class="btn btn-light position-relative rounded-circle p-2" type="button" id="notificationBtn" data-bs-toggle="dropdown">
                        <i class="fas fa-bell text-secondary"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light p-1 d-none" id="notificationBadge">0</span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end" id="notificationMenu">
                        <h6 class="dropdown-header">Notifications</h6>
                        <div class="dropdown-item text-center text-muted small">No new notifications</div>
                    </div>
                </div>
                
                <!-- Mobile Logout -->
                <button class="btn btn-link d-lg-none text-white p-2" id="mobileLogoutBtn">
                    <i class="fas fa-sign-out-alt fa-lg"></i>
                </button>

                <!-- User Menu -->
                <div class="dropdown d-none d-lg-block">
                    <button class="btn btn-light dropdown-toggle d-flex align-items-center rounded-pill px-3" type="button" data-bs-toggle="dropdown">
                        <div class="avatar-sm me-2">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="userName" class="d-none d-md-block fw-medium">Loading...</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                        <li><h6 class="dropdown-header" id="userEmail">Loading...</h6></li>
                        <li><a class="dropdown-item" href="#" onclick="window.navigateToSection('profile'); return false;"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#" onclick="window.navigateToSection('settings'); return false;"><i class="fas fa-cog me-2"></i>Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="position-sticky">
            <!-- Mobile User Profile -->
            <div class="d-lg-none text-center py-4 mb-2" style="background: rgba(0,0,0,0.03);">
                <div class="avatar-circle-lg bg-primary text-white mx-auto mb-2 d-flex align-items-center justify-content-center shadow-sm" style="width: 60px; height: 60px; font-size: 1.5rem; border-radius: 50%;">
                    <i class="fas fa-user"></i>
                </div>
                <h6 class="mb-0 fw-bold text-dark" id="sidebarUserName">User</h6>
                <small class="text-muted d-block mb-3" id="sidebarUserEmail">email@example.com</small>
                <a href="#" onclick="window.navigateToSection('profile'); return false;" class="btn btn-sm btn-outline-primary rounded-pill px-4">
                    View Profile
                </a>
            </div>

            <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="suppliers">
                                <i class="fas fa-handshake me-2"></i>
                                Suppliers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="inventory">
                                <i class="fas fa-boxes me-2"></i>
                                Inventory
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="raw-materials">
                                <i class="fas fa-layer-group me-2"></i>
                                Raw Materials
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="production">
                                <i class="fas fa-industry me-2"></i>
                                Production
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="customers">
                                <i class="fas fa-users me-2"></i>
                                Customers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="projects">
                                <i class="fas fa-project-diagram me-2"></i>
                                Projects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="invoices">
                                <i class="fas fa-file-invoice-dollar me-2"></i>
                                Invoices
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="vehicles">
                                <i class="fas fa-truck me-2"></i>
                                Vehicles
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="staff">
                                <i class="fas fa-id-card me-2"></i>
                                Staff & Attendance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="settings">
                                <i class="fas fa-cog me-2"></i>
                                Settings
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Quick Stats -->
                    <div class="mt-5 p-3 bg-light rounded-3 mx-2">
                        <h6 class="border-bottom pb-2">Quick Stats</h6>
                        <div class="row text-center mt-3">
                            <div class="col-6 mb-3">
                                <div class="stat-value" id="totalProjects">0</div>
                                <small class="text-muted">Projects</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-value" id="totalCustomers">0</div>
                                <small class="text-muted">Customers</small>
                            </div>
                            <div class="col-6">
                                <div class="stat-value text-success" id="monthlyRevenue">₹0</div>
                                <small class="text-muted">Revenue</small>
                            </div>
                            <div class="col-6">
                                <div class="stat-value text-warning" id="pendingInvoices">0</div>
                                <small class="text-muted">Pending</small>
                            </div>
                        </div>
                    </div>
        </div>
    </nav>

            <!-- Main Content -->
            <main>
                <!-- Alert Container -->
                <div id="alertMessage" class="alert d-none mt-3"></div>

                <!-- SECTION: DASHBOARD -->
                <div id="section-dashboard" class="main-section">
                
                <!-- Mobile Hero & Nav (Visible only on mobile/tablet) -->
                <div class="d-lg-none">
                    <div class="mobile-hero-container">
                        <i class="fas fa-pipe-circle-notch mobile-hero-bg-icon"></i>
                        <div class="d-flex justify-content-between align-items-center position-relative z-1">
                            <div>
                                <h2 class="fw-bold mb-1">Hello, <span id="mobileUserName">User</span></h2>
                                <p class="mb-0 opacity-75 small">Here's your business overview</p>
                            </div>
                            <div class="hero-logo-box">
                                <div class="hero-spinner-ring hero-ring-outer"></div>
                                <div class="hero-spinner-ring hero-ring-inner"></div>
                                <img src="logo.png" class="hero-center-icon" alt="Logo">
                            </div>
                        </div>
                    </div>

                    <!-- 4x2 Nav Grid -->
                    <div class="container-fluid px-0 mb-4" style="margin-top: -30px;">
                        <div class="row g-2 px-2">
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('suppliers'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-primary bg-opacity-10 text-primary"><i class="fas fa-handshake"></i></div>
                                    <span class="nav-label">Vendors</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('inventory'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-primary bg-opacity-10 text-primary"><i class="fas fa-boxes"></i></div>
                                    <span class="nav-label">Stock</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('production'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-warning bg-opacity-10 text-warning"><i class="fas fa-industry"></i></div>
                                    <span class="nav-label">Make</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('customers'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-danger bg-opacity-10 text-danger"><i class="fas fa-users"></i></div>
                                    <span class="nav-label">Clients</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('invoices'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-success bg-opacity-10 text-success"><i class="fas fa-file-invoice-dollar"></i></div>
                                    <span class="nav-label">Bill</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('projects'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-info bg-opacity-10 text-info"><i class="fas fa-project-diagram"></i></div>
                                    <span class="nav-label">Projects</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('vehicles'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-dark bg-opacity-10 text-dark"><i class="fas fa-truck"></i></div>
                                    <span class="nav-label">Fleet</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('staff'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-secondary bg-opacity-10 text-secondary"><i class="fas fa-id-card"></i></div>
                                    <span class="nav-label">Staff</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Desktop Header -->
                <div class="d-none d-lg-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button class="btn btn-primary me-2">
                            <i class="fas fa-plus me-1"></i> New Project
                        </button>
                        <button class="btn btn-success me-2" id="profitReportBtn">
                            <i class="fas fa-chart-line me-1"></i> Profit Report
                        </button>
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-download me-1"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-6 col-xl-3 mb-3 mb-xl-4">
                        <div class="card border-start-primary shadow-sm h-100 py-2 stat-card-mobile">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                                            Monthly Revenue
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="revenueAmount">₹0</div>
                                    </div>
                                    <div class="col-auto d-none d-lg-block">
                                        <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 col-xl-3 mb-3 mb-xl-4">
                        <div class="card border-start-success shadow-sm h-100 py-2 stat-card-mobile">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs fw-bold text-success text-uppercase mb-1">
                                            Active Projects
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="activeProjects">0</div>
                                    </div>
                                    <div class="col-auto d-none d-lg-block">
                                        <i class="fas fa-project-diagram fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 col-xl-3 mb-3 mb-xl-4">
                        <div class="card border-start-warning shadow-sm h-100 py-2 stat-card-mobile">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                                            Low Stock Items
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="lowStockItems">0</div>
                                    </div>
                                    <div class="col-auto d-none d-lg-block">
                                        <i class="fas fa-boxes fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 col-xl-3 mb-3 mb-xl-4">
                        <div class="card border-start-info shadow-sm h-100 py-2 stat-card-mobile">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs fw-bold text-info text-uppercase mb-1">
                                            Pending Invoices
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="pendingAmount">₹0</div>
                                        <div class="mt-2 mb-0 text-muted text-xs">
                                            <span class="text-warning me-2">
                                                <i class="fas fa-clock"></i>
                                            </span>
                                            <span>Awaiting payment</span>
                                        </div>
                                    </div>
                                    <div class="col-auto d-none d-lg-block">
                                        <i class="fas fa-file-invoice-dollar fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Recent Activity -->
                <div class="row">
                    <!-- Revenue Chart -->
                    <div class="col-xl-8 col-lg-7">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 fw-bold text-primary">Revenue Overview</h6>
                                <div class="dropdown no-arrow">
                                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end shadow">
                                        <a class="dropdown-item" href="#">View Details</a>
                                        <a class="dropdown-item" href="#">Export Data</a>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-area">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Projects -->
                    <div class="col-xl-4 col-lg-5">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 fw-bold text-primary">Recent Projects</h6>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush" id="recentProjects">
                                    <!-- Projects will be loaded here -->
                                </div>
                                <div class="text-center mt-3">
                                    <a href="#" onclick="window.navigateToSection('projects'); return false;" class="btn btn-sm btn-outline-primary">View All Projects</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card shadow">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 fw-bold text-primary">Recent Transactions</h6>
                                <a href="#" onclick="window.navigateToSection('invoices'); return false;" class="btn btn-sm btn-primary">View All</a>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="transactionsTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Description</th>
                                                <th>Customer</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Transactions will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- SECTION: INVENTORY -->
                <div id="section-inventory" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Inventory Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary me-2" id="addItemBtn">
                                <i class="fas fa-plus me-1"></i> Add Item
                            </button>
                            <button class="btn btn-outline-secondary">
                                <i class="fas fa-download me-1"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Items</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_totalItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-boxes fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Low Stock</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_lowStockItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Total Value</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_inventoryValue">₹0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="searchInventory" placeholder="Search items...">
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="inventoryTable">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>Qty</th>
                                            <th>Reorder</th>
                                            <th>Unit</th>
                                            <th>Cost</th>
                                            <th>Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: RAW MATERIALS -->
                <div id="section-raw-materials" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Raw Materials</h1>
                        <button class="btn btn-primary" id="addRawMaterialBtn">
                            <i class="fas fa-plus me-1"></i> Add Material
                        </button>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Materials</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_totalItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-layer-group fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Low Stock</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_lowStock">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Stock Value</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_totalValue">₹0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="rawMaterialTable">
                                    <thead>
                                        <tr>
                                            <th>Material Name</th>
                                            <th>Category</th>
                                            <th>Supplier</th>
                                            <th>Quantity</th>
                                            <th>Reorder Level</th>
                                            <th>Cost (₹)</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: SUPPLIERS -->
                <div id="section-suppliers" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Supplier Management</h1>
                        <button class="btn btn-primary" id="addSupplierBtn">
                            <i class="fas fa-plus me-1"></i> Add Supplier
                        </button>
                    </div>

                    <!-- Filter Controls -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchSuppliers" placeholder="Search by name, contact, or phone...">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filterSupplierType">
                                        <option value="all">All Types</option>
                                        <!-- Options populated by JS -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Supplier Cards -->
                    <div class="row" id="suppliersContainer">
                        <!-- Supplier cards will be loaded here by JS -->
                    </div>
                </div>

                <!-- SECTION: STAFF -->
                <div id="section-staff" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Staff & Attendance</h1>
                        <div>
                            <button class="btn btn-outline-dark me-2" id="attendanceSettingsBtn">
                                <i class="fas fa-cog me-1"></i> Settings
                            </button>
                            <button class="btn btn-outline-primary me-2" id="generateQrBtn">
                                <i class="fas fa-qrcode me-1"></i> Attendance QR
                            </button>
                            <button class="btn btn-primary" id="addStaffBtn">
                                <i class="fas fa-user-plus me-1"></i> Add Staff
                            </button>
                        </div>
                    </div>

                    <!-- Staff Tabs -->
                    <ul class="nav nav-tabs mb-4" id="staffTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="staff-list-tab" data-bs-toggle="tab" data-bs-target="#staffListPane" type="button" role="tab">Staff List</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="attendance-log-tab" data-bs-toggle="tab" data-bs-target="#attendanceLogPane" type="button" role="tab">Attendance Log</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="payroll-tab" data-bs-toggle="tab" data-bs-target="#payrollPane" type="button" role="tab">Payroll Report</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="staffTabContent">
                        <!-- Staff List Pane -->
                        <div class="tab-pane fade show active" id="staffListPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="staffTable">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Mobile</th>
                                                    <th>Role</th>
                                                    <th>Daily Wage</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Log Pane -->
                        <div class="tab-pane fade" id="attendanceLogPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Today's Attendance</h6>
                                    <div class="d-flex gap-2">
                                        <input type="date" class="form-control form-control-sm w-auto" id="attendanceDateFilter">
                                        <button class="btn btn-sm btn-primary" id="manualAttendanceBtn"><i class="fas fa-plus me-1"></i> Manual Entry</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="attendanceTable">
                                            <thead>
                                                <tr>
                                                    <th>Time</th>
                                                    <th>Staff Name</th>
                                                    <th>Role</th>
                                                    <th>Wage Earned</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payroll Pane -->
                        <div class="tab-pane fade" id="payrollPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Monthly Payroll</h6>
                                    <div class="d-flex gap-2">
                                        <input type="month" class="form-control form-control-sm w-auto" id="payrollMonthFilter">
                                        <button class="btn btn-sm btn-outline-success" id="exportPayrollCsvBtn" title="Export CSV"><i class="fas fa-file-csv"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" id="exportPayrollPdfBtn" title="Export PDF"><i class="fas fa-file-pdf"></i></button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="window.print()" title="Print"><i class="fas fa-print"></i></button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="payrollTable">
                                            <thead>
                                                <tr>
                                                    <th>Staff Name</th>
                                                    <th>Role</th>
                                                    <th>Days Present</th>
                                                    <th>Total Wages</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                            <tfoot class="table-light fw-bold">
                                                <tr><td colspan="3" class="text-end">Total Payout:</td><td id="payrollTotalWages">₹0</td></tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PRODUCTION -->
                <div id="section-production" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Production Management</h1>
                        <div>
                            <button class="btn btn-outline-primary me-2" id="manageProductsBtn">
                                <i class="fas fa-cogs me-1"></i> Mould & Product Master
                            </button>
                            <button class="btn btn-primary" id="addProductionBtn">
                                <i class="fas fa-hammer me-1"></i> New Production Run
                            </button>
                        </div>
                    </div>

                    <!-- Curing Status Cards -->
                    <div class="row mb-4" id="curingStatsContainer">
                        <!-- Populated by JS -->
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 fw-bold text-primary">Recent Production Runs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="productionTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Finished Good</th>
                                            <th>Quantity Produced</th>
                                            <th>Materials Used</th>
                                            <th>Curing Status</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: VEHICLES -->
                <div id="section-vehicles" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Vehicle Management</h1>
                        <div>
                            <button class="btn btn-outline-warning me-2" id="expiryReportBtn">
                                <i class="fas fa-file-contract me-1"></i> Expiry Report
                            </button>
                            <button class="btn btn-primary" id="addVehicleBtn">
                                <i class="fas fa-truck-medical me-1"></i> Add Vehicle
                            </button>
                        </div>
                    </div>

                    <div class="row" id="vehiclesContainer">
                        <!-- Vehicle Cards Loaded Here -->
                    </div>

                    <div class="card shadow mt-4">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 fw-bold text-primary">Recent Vehicle Expenses & Maintenance</h6>
                            <button class="btn btn-sm btn-outline-primary" id="addExpenseBtn">
                                <i class="fas fa-receipt me-1"></i> Add Expense
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="vehicleExpensesTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Vehicle</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Cost</th>
                                            <th>Odometer</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="text-center">Loading expenses...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: CUSTOMERS -->
                <div id="section-customers" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Customer Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary me-2" id="addCustomerBtn">
                                <i class="fas fa-user-plus me-1"></i> Add Customer
                            </button>
                            <div class="btn-group me-2">
                                <button class="btn btn-outline-secondary" id="importCustomersBtn">
                                    <i class="fas fa-upload me-1"></i> Import
                                </button>
                                <button class="btn btn-outline-secondary" id="exportCustomersBtn">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Customers</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_totalCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-users fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Active Customers</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_activeCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-user-check fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-info text-uppercase mb-1">Leads</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_leadCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-bullhorn fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Revenue</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_customerRevenue">₹0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-controls mb-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchCustomers" placeholder="Search customers...">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="filterType">
                                    <option value="all">All Types</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="customersTable">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Phone</th>
                                            <th>Company</th>
                                            <th>Type</th>
                                            <th>Projects</th>
                                            <th>Total Spent</th>
                                            <th>Status</th>
                                            <th>Last Contact</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PROJECTS -->
                <div id="section-projects" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Projects</h1>
                        <button class="btn btn-primary" id="addProjectBtn">
                            <i class="fas fa-plus me-1"></i> New Project
                        </button>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="projectsTable">
                                    <thead>
                                        <tr>
                                            <th>Project Name</th>
                                            <th>Customer</th>
                                            <th>Status</th>
                                            <th>Start Date</th>
                                            <th>Value</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: INVOICES -->
                <div id="section-invoices" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Invoices</h1>
                        <div>
                            <button class="btn btn-outline-dark me-2" id="invoiceSettingsBtn">
                                <i class="fas fa-palette me-1"></i> Templates
                            </button>
                            <button class="btn btn-primary" id="createInvoiceBtn">
                                <i class="fas fa-plus me-1"></i> Create Invoice
                            </button>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="invoicesTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Invoice #</th>
                                            <th>Customer</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PROFILE -->
                <div id="section-profile" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">My Profile</h1>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card shadow text-center p-4">
                                <div class="avatar-circle-lg bg-primary text-white mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; font-size: 2.5rem; border-radius: 50%;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <h4 id="profileDisplayName" class="mb-1">Loading...</h4>
                                <p id="profileEmail" class="text-muted mb-3">loading...</p>
                                <div class="badge bg-success mb-3">Pro Plan</div>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Personal Details</h6>
                                </div>
                                <div class="card-body">
                                    <form id="profileForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">First Name</label>
                                                <input type="text" class="form-control" id="profileFirstName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" class="form-control" id="profileLastName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="profilePhone">
                                            </div>
                                            <div class="col-12 text-end">
                                                <button type="submit" class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Security</h6>
                                </div>
                                <div class="card-body">
                                    <form id="passwordForm">
                                        <div class="mb-3">
                                            <label class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="newPassword" minlength="6">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="confirmNewPassword" minlength="6">
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-warning" id="changePasswordBtn">Update Password</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: SETTINGS -->
                <div id="section-settings" class="main-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Business Settings</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Company Information</h6>
                                </div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Company Name</label>
                                                <input type="text" class="form-control" id="companyName" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Tax ID / GSTIN</label>
                                                <input type="text" class="form-control" id="taxId">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">UPI ID (for QR Code)</label>
                                                <input type="text" class="form-control" id="companyUpiId" placeholder="username@bank">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Business Email</label>
                                                <input type="email" class="form-control" id="companyEmail">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Business Phone</label>
                                                <input type="text" class="form-control" id="companyPhone">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Address</label>
                                                <input type="text" class="form-control" id="companyAddress">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">City</label>
                                                <input type="text" class="form-control" id="companyCity">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">State</label>
                                                <input type="text" class="form-control" id="companyState">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Zip Code</label>
                                                <input type="text" class="form-control" id="companyZip">
                                            </div>
                                            
                                            <div class="col-12"><hr class="my-2"></div>
                                            <h6 class="fw-bold text-secondary mb-0">Branding & Documents</h6>
                                            
                                            <div class="col-md-6">
                                                <label class="form-label">Company Logo</label>
                                                <input type="file" class="form-control" id="companyLogo" accept="image/*">
                                                <div id="logoPreview" class="mt-2 d-flex align-items-center gap-2"></div>
                                                <input type="hidden" id="logoUrl">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Authorized Signature</label>
                                                <input type="file" class="form-control" id="companySignature" accept="image/*">
                                                <div id="signaturePreview" class="mt-2 d-flex align-items-center gap-2"></div>
                                                <input type="hidden" id="signatureUrl">
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label">Currency</label>
                                                <select class="form-select" id="currency" disabled>
                                                    <option value="INR" selected>Indian Rupee (₹)</option>
                                                </select>
                                            </div>
                                            <div class="col-12 mt-4 text-end">
                                                <button type="submit" class="btn btn-primary" id="saveSettingsBtn">
                                                    <i class="fas fa-save me-2"></i>Save Business Settings
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Preferences</h6>
                                </div>
                                <div class="card-body">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="emailNotifs" checked>
                                        <label class="form-check-label" for="emailNotifs">Email Notifications</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="lowStockAlerts" checked>
                                        <label class="form-check-label" for="lowStockAlerts">Low Stock Alerts</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="autoExpiryReports" checked>
                                        <label class="form-check-label" for="autoExpiryReports">Automatic Expiry Reports</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                                        <label class="form-check-label" for="darkModeToggle">Dark Mode (Beta)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Team Management Card -->
                        <div class="col-12 mt-4" id="teamManagementCard">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Team Access (Max 3 Users)</h6>
                                    <button class="btn btn-sm btn-primary" id="addTeamMemberBtn"><i class="fas fa-user-plus me-1"></i> Add Member</button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="teamTable">
                                            <thead>
                                                <tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

    <!-- Mobile Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- MODALS -->
    <!-- Item History Modal -->
    <div class="modal fade" id="itemHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Item History: <span id="historyItemName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover" id="itemHistoryTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Quantity</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="modal fade" id="inventoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add Inventory Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="inventoryForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">SKU</label>
                                <input type="text" class="form-control" id="sku">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="category">
                                    <option value="Finished Goods">Finished Goods (Tanks/Rings)</option>
                                    <option value="Molds">Molds & Equipment</option>
                                    <option value="PVC Pipes">PVC Pipes</option>
                                    <option value="Fittings">Fittings</option>
                                    <option value="Tools">Tools</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Unit</label>
                                <input type="text" class="form-control" id="unit" value="piece">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="quantity" value="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Reorder Level</label>
                                <input type="number" class="form-control" id="reorderLevel" value="10">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Cost Price (₹)</label>
                                <input type="number" class="form-control" id="costPrice" step="0.01">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Selling Price (₹)</label>
                                <input type="number" class="form-control" id="sellingPrice" step="0.01">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="description" rows="2"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Supplier</label>
                                <select class="form-select" id="supplier">
                                    <option value="">Select Supplier...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="location">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveItemBtn">Save Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Raw Material Modal -->
    <div class="modal fade" id="rawMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rmModalTitle">Add Raw Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="rawMaterialForm">
                        <div class="mb-3">
                            <label class="form-label">Material Name</label>
                            <input type="text" class="form-control" id="rmName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="rmCategory">
                                <option value="Raw Materials">Raw Materials (General)</option>
                                <option value="Cement">Cement</option>
                                <option value="Sand">Sand</option>
                                <option value="Aggregate">Aggregate (Metal)</option>
                                <option value="Steel">Steel</option>
                                <option value="Additives">Additives</option>
                                <option value="Chemicals">Chemicals</option>
                            </select>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6"><label class="form-label">Quantity</label><input type="number" class="form-control" id="rmQuantity" value="0"></div>
                            <div class="col-6"><label class="form-label">Unit</label><input type="text" class="form-control" id="rmUnit" value="kg"></div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6"><label class="form-label">Reorder Level</label><input type="number" class="form-control" id="rmReorder" value="100"></div>
                            <div class="col-6"><label class="form-label">Cost Price (₹)</label><input type="number" class="form-control" id="rmCost"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Supplier</label>
                            <select class="form-select" id="rmSupplier"></select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveRawMaterialBtn">Save Material</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="customerEmail">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="text" class="form-control" id="customerPhone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Company</label>
                                <input type="text" class="form-control" id="customerCompany">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="customerType">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="customerStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Lead">Lead</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" id="customerAddress">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" id="customerCity">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">State</label>
                                <input type="text" class="form-control" id="customerState">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Zip</label>
                                <input type="text" class="form-control" id="customerZip">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Services Interested In</label>
                                <select class="form-select" id="services" multiple>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="customerNotes" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tax ID (Optional)</label>
                                <input type="text" class="form-control" id="customerTaxId">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerBtn">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal fade" id="projectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Project Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="projectForm">
                        <div class="mb-3">
                            <label class="form-label">Project Name</label>
                            <input type="text" class="form-control" id="projectName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Customer Name</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="projectStatus">
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Value (₹)</label>
                            <input type="number" class="form-control" id="projectValue">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveProjectBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div class="modal fade" id="invoiceModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Invoice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="invoiceForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Customer</label>
                                <select class="form-select" id="invCustomerSelect" required>
                                    <option value="">Select Customer...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Invoice Date</label>
                                <input type="date" class="form-control" id="invDate" required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Project (Optional)</label>
                                <select class="form-select" id="invProjectSelect"></select>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Vehicle (Delivery)</label>
                                <select class="form-select" id="invVehicle"></select>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Driver Name</label>
                                <input type="text" class="form-control" id="invDriver">
                            </div>
                        </div>
                        
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">Items</h6>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="invAddItemBtn">
                                <i class="fas fa-plus"></i> Add Item
                            </button>
                        </div>
                        
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered table-sm" id="invItemsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 40%">Item</th>
                                        <th style="width: 15%">Qty</th>
                                        <th style="width: 20%">Price</th>
                                        <th style="width: 20%">Total</th>
                                        <th style="width: 5%"></th>
                                    </tr>
                                </thead>
                                <tbody id="invItemsContainer"></tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" class="text-end">Transport Cost:</td>
                                        <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="invTransportCost" value="0"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="text-end">Amount Paid:</td>
                                        <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="invAmountPaid" value="0"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="text-end">Balance Due:</td>
                                        <td colspan="2" class="text-end fw-bold text-danger" id="invBalance">₹0.00</td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="text-end fw-bold">Grand Total:</td>
                                        <td colspan="2" class="fw-bold text-primary" id="invGrandTotal">₹0.00</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Customer Signature</label>
                            <div class="border rounded p-2 bg-light text-center">
                                <canvas id="signaturePad" width="400" height="150" class="bg-white border shadow-sm" style="touch-action: none;"></canvas>
                                <div class="mt-2 text-end">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="clearSignatureBtn"><i class="fas fa-eraser me-1"></i>Clear</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveInvoiceBtn">Create Invoice</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Settings Modal -->
    <div class="modal fade" id="invoiceSettingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Invoice Design</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100 template-card border-primary" style="cursor: pointer;" onclick="window.selectTemplate('modern')" id="tpl_modern">
                                <div class="card-body text-center">
                                    <h6 class="fw-bold text-primary">Modern Clean</h6>
                                    <p class="small text-muted">Minimalist, plenty of whitespace, blue accents.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 template-card" style="cursor: pointer;" onclick="window.selectTemplate('corporate')" id="tpl_corporate">
                                <div class="card-body text-center">
                                    <h6 class="fw-bold text-dark">Corporate Pro</h6>
                                    <p class="small text-muted">Dark header, striped rows, professional look.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 template-card" style="cursor: pointer;" onclick="window.selectTemplate('elegant')" id="tpl_elegant">
                                <div class="card-body text-center">
                                    <h6 class="fw-bold text-secondary" style="font-family: serif;">Elegant Serif</h6>
                                    <p class="small text-muted">Classic typography, traditional layout.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 template-card" style="cursor: pointer;" onclick="window.selectTemplate('bold')" id="tpl_bold">
                                <div class="card-body text-center">
                                    <h6 class="fw-bold text-danger">Bold Impact</h6>
                                    <p class="small text-muted">High contrast, thick borders, strong headers.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="selectedTemplate" value="modern">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveInvoiceSettingsBtn">Save Preference</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 p-2 bg-light rounded border">
                        <div class="d-flex justify-content-between">
                            <span>Invoice: <strong id="phInvoiceNo"></strong></span>
                            <span>Balance: <strong id="phBalance" class="text-danger"></strong></span>
                        </div>
                    </div>
                    
                    <div class="table-responsive mb-3">
                        <table class="table table-sm table-bordered" id="paymentHistoryTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Mode</th><th>Ref</th><th class="text-end">Amount</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <hr>
                    <h6 class="mb-3 text-primary">Record New Payment</h6>
                    <form id="paymentForm">
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label small">Date</label><input type="date" class="form-control form-control-sm" id="payDate" required></div>
                            <div class="col-6"><label class="form-label small">Amount (₹)</label><input type="number" class="form-control form-control-sm" id="payAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label small">Mode</label><select class="form-select form-select-sm" id="payMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label small">Reference / Note</label><input type="text" class="form-control form-control-sm" id="payRef" placeholder="Txn ID / Cheque No"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="savePaymentBtn">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advance Payment Modal -->
    <div class="modal fade" id="advancePaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Advance Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="advancePaymentForm">
                        <input type="hidden" id="advCustomerId">
                        <div class="mb-3">
                            <label class="form-label">Customer</label>
                            <input type="text" class="form-control" id="advCustomerName" readonly>
                        </div>
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label">Date</label><input type="date" class="form-control" id="advDate" required></div>
                            <div class="col-6"><label class="form-label">Amount (₹)</label><input type="number" class="form-control" id="advAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label">Mode</label><select class="form-select" id="advMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label">Reference</label><input type="text" class="form-control" id="advRef" placeholder="Txn ID"></div>
                        </div>
                        <div class="mb-3 mt-2">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="advNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveAdvancePaymentBtn">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Ledger Modal -->
    <div class="modal fade" id="customerLedgerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Customer Ledger: <span id="ledgerCustomerName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control form-control-sm" id="ledgerStartDate">
                            <input type="date" class="form-control form-control-sm" id="ledgerEndDate">
                            <button class="btn btn-sm btn-outline-primary" id="filterLedgerBtn">Filter</button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.printLedger()">
                                <i class="fas fa-print me-1"></i> Print Statement
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered table-hover" id="ledgerTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Description</th><th>Ref / Inv #</th><th class="text-end">Debit (Inv)</th><th class="text-end">Credit (Pay)</th><th class="text-end">Balance</th></tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot class="table-light fw-bold">
                                <tr><td colspan="3" class="text-end">Totals:</td><td class="text-end" id="ledgerTotalDebit">₹0</td><td class="text-end" id="ledgerTotalCredit">₹0</td><td class="text-end" id="ledgerFinalBalance">₹0</td></tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock In/Out Modals -->
    <div class="modal fade" id="stockInModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stock In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="item-name mb-3"></h6>
                    <div class="mb-3">
                        <label class="form-label">Quantity to Add</label>
                        <input type="number" class="form-control" id="stockInQuantity">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Supplier Name</label>
                        <select class="form-select" id="stockInSupplier"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Invoice Number</label>
                        <input type="text" class="form-control" id="stockInInvoice">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Transport Cost (₹)</label>
                        <input type="number" class="form-control" id="stockInTransportCost" value="0">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cost per Unit</label>
                        <input type="number" class="form-control" id="stockInCost">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">GST (%)</label>
                        <input type="number" class="form-control" id="stockInGst" value="18" placeholder="e.g. 18">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Upload Invoice</label>
                        <input type="file" class="form-control" id="stockInFile">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason/Source</label>
                        <input type="text" class="form-control" id="stockInReason" value="Purchase">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirmStockInBtn">Confirm Stock In</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="stockOutModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stock Out</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="item-name mb-3"></h6>
                    <div class="mb-3">
                        <label class="form-label">Quantity to Remove</label>
                        <input type="number" class="form-control" id="stockOutQuantity">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason</label>
                        <input type="text" class="form-control" id="stockOutReason" value="Project Use">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Project (Optional)</label>
                        <input type="text" class="form-control" id="stockOutProject">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Customer (For Delivery Challan)</label>
                        <select class="form-select" id="stockOutCustomer"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Vehicle (Dispatch)</label>
                        <select class="form-select" id="stockOutVehicle"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Driver Name</label>
                        <input type="text" class="form-control" id="stockOutDriver">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" id="confirmStockOutBtn">Confirm Stock Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Production Modal -->
    <div class="modal fade" id="productionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Production Run</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productionForm">
                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label fw-bold">Select Product / Work Order</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-clipboard-list"></i></span>
                                    <select class="form-select" id="recipeSelect">
                                        <option value="">Select Product Definition...</option>
                                    </select>
                                    <button class="btn btn-outline-danger" type="button" id="deleteRecipeBtn" title="Delete Selected Recipe"><i class="fas fa-trash"></i></button>
                                </div>
                                <div id="productDetails" class="form-text text-primary fw-bold mt-1"></div>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label class="form-label fw-bold">Finished Good (Output)</label>
                                <select class="form-select" id="finishedGoodSelect" required>
                                    <!-- Populated via JS -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Quantity Produced</label>
                                <input type="number" class="form-control" id="produceQuantity" min="1" required>
                            </div>
                            <div class="col-md-4 mt-3">
                                <label class="form-label text-danger">Broken/Damaged (Qty)</label>
                                <input type="number" class="form-control" id="brokenQuantity" value="0" min="0">
                            </div>
                            <div class="col-md-4 mt-3">
                                <label class="form-label text-warning">Material Wastage (Kg/Est)</label>
                                <input type="number" class="form-control" id="wastageQuantity" value="0" min="0">
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Production Date</label>
                                <input type="date" class="form-control" id="productionDate">
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Supervisor Name</label>
                                <input type="text" class="form-control" id="productionSupervisor">
                            </div>
                            <div class="col-md-3 mt-3">
                                <label class="form-label">Labour Cost (₹)</label>
                                <input type="number" class="form-control" id="labourCost" value="0">
                            </div>
                            <div class="col-md-3 mt-3">
                                <label class="form-label">Power Cost (₹)</label>
                                <input type="number" class="form-control" id="powerCost" value="0">
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Moulds Assigned</label>
                                <input type="text" class="form-control" id="mouldsUsed" placeholder="Auto-filled from Product Master">
                            </div>
                            <div class="col-md-6 mt-3">
                                <label class="form-label">Curing Period (Days)</label>
                                <input type="number" class="form-control" id="curingDays" value="1" min="0">
                            </div>
                        </div>
                        
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label fw-bold mb-0">Raw Materials Used (Input)</label>
                            <span id="stockStatusBadge" class="badge bg-secondary">Status: Pending</span>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="addIngredientBtn"><i class="fas fa-plus"></i> Add Material</button>
                        </div>
                        
                        <div id="ingredientsContainer" class="mb-3 p-2 bg-light rounded">
                            <!-- Dynamic Rows -->
                        </div>
                        
                        <div class="d-flex justify-content-end mb-3">
                             <h6 class="mb-0">Estimated Cost: <span class="text-primary fw-bold" id="estimatedCost">₹0.00</span></h6>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="productionNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-info" id="createRecipeBtn">Save as Recipe</button>
                    <div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="saveProductionBtn">Complete Production</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product & Mould Master Modal -->
    <div class="modal fade" id="productMasterModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mould & Product Master Setup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row h-100">
                        <!-- Left: List -->
                        <div class="col-md-4 border-end">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0">Defined Products</h6>
                                <button class="btn btn-sm btn-outline-success" id="newProductBtn"><i class="fas fa-plus"></i> New</button>
                            </div>
                            <div class="list-group list-group-flush overflow-auto" id="productListContainer" style="max-height: 500px;">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <!-- Right: Form -->
                        <div class="col-md-8">
                            <h6 class="fw-bold text-primary mb-3" id="pmModalTitle">New Product Definition</h6>
                            <form id="productMasterForm">
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Product Name</label>
                                        <input type="text" class="form-control" id="pmName" placeholder="e.g. 1000L Septic Tank">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Product Type</label>
                                        <select class="form-select" id="pmType">
                                            <option value="Septic Tank">Septic Tank</option>
                                            <option value="Water Tank">Water Tank</option>
                                            <option value="Drainage Ring">Drainage Ring</option>
                                            <option value="Manhole Cover">Manhole Cover</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Size / Dimensions</label>
                                        <input type="text" class="form-control" id="pmDimensions" placeholder="Dia x Height x Thickness">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Compatible Mould IDs</label>
                                        <input type="text" class="form-control" id="pmMouldIds" placeholder="e.g. M001, M002">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Linked Inventory Item (Finished Good)</label>
                                        <select class="form-select" id="pmFinishedGood"></select>
                                    </div>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label fw-bold mb-0">Standard Material Consumption (Recipe)</label>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="pmIngredientBtn"><i class="fas fa-plus"></i> Add Material</button>
                                </div>
                                <div id="pmIngredientsContainer" class="mb-3 p-2 bg-light rounded" style="max-height: 250px; overflow-y: auto;"></div>
                                <div class="text-end">
                                    <button type="button" class="btn btn-primary" id="saveProductMasterBtn">Save Definition</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profit Report Modal -->
    <div class="modal fade" id="profitReportModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profit Engine Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h6>Total Net Profit (All Time)</h6>
                                    <h3 id="prTotalProfit">₹0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h6>Avg Profit Margin</h6>
                                    <h3 id="prAvgMargin">0%</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-warning text-dark">
                                <div class="card-body">
                                    <h6>Outstanding Collections</h6>
                                    <h3 id="prOutstanding">₹0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <ul class="nav nav-tabs mb-3" id="profitTabs">
                        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#prByProduct">By Product/Size</a></li>
                        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#prByTime">By Month</a></li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="prByProduct">
                            <div class="table-responsive">
                                <table class="table table-hover" id="prProductTable">
                                    <thead><tr><th>Product</th><th>Qty Sold</th><th>Avg Cost</th><th>Avg Price</th><th>Total Profit</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="prByTime">
                            <div class="table-responsive">
                                <table class="table table-hover" id="prTimeTable">
                                    <thead><tr><th>Month</th><th>Revenue</th><th>Cost</th><th>Net Profit</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Modal -->
    <div class="modal fade" id="vehicleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicleForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Vehicle Number (Reg. No)</label>
                                <input type="text" class="form-control" id="vehicleName" placeholder="e.g. KA-01-AB-1234" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Model / Make</label>
                                <input type="text" class="form-control" id="vehicleModel" placeholder="e.g. Tata Ace Gold">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="vehicleType">
                                    <option value="Truck">Truck / Lorry</option>
                                    <option value="Trolley">Tractor Trolley</option>
                                    <option value="JCB">JCB / Excavator</option>
                                    <option value="Mixer">Concrete Mixer</option>
                                    <option value="Car">Car / SUV</option>
                                    <option value="Bike">Bike / Scooter</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Owner Name</label>
                                <input type="text" class="form-control" id="vehicleOwner">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Owner Phone</label>
                                <input type="tel" class="form-control" id="vehicleOwnerPhone" placeholder="Mobile Number">
                            </div>
                            
                            <div class="col-12"><hr class="my-1"></div>
                            
                            <div class="col-md-6">
                                <label class="form-label">RC / Chassis No</label>
                                <input type="text" class="form-control" id="vehicleChassis">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Engine No</label>
                                <input type="text" class="form-control" id="vehicleEngine">
                            </div>
                            
                            <div class="col-12"><hr class="my-1"></div>
                            
                            <div class="col-md-6">
                                <label class="form-label">Fastag ID / Bank</label>
                                <input type="text" class="form-control" id="vehicleFastagId">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Current Fastag Balance (₹)</label>
                                <input type="number" class="form-control" id="vehicleFastagBalance" value="0">
                            </div>

                            <div class="col-12"><hr class="my-1"></div>
                            <h6 class="text-primary mb-2">Document Expiry Dates</h6>

                            <div class="col-md-6">
                                <label class="form-label">Insurance Expiry</label>
                                <input type="date" class="form-control" id="insuranceExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Permit / Tax Expiry</label>
                                <input type="date" class="form-control" id="permitExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fitness Cert. Expiry</label>
                                <input type="date" class="form-control" id="fitnessExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">PUC (Pollution) Expiry</label>
                                <input type="date" class="form-control" id="pucExpiry">
                            </div>

                            <div class="col-12"><hr class="my-1"></div>
                            <div class="col-12 d-flex justify-content-between align-items-center">
                                <h6 class="text-primary mb-2">Document Photos</h6>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="compressImages" checked>
                                    <label class="form-check-label small" for="compressImages">Compress to 50KB</label>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label small">RC Copy</label>
                                <div id="rcExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="rcLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View RC</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('rc')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="rcFile" accept="image/*" onchange="window.handleFileSelect('rc')">
                                <div id="rcStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="rcUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Insurance Copy</label>
                                <div id="insuranceExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="insuranceLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Ins.</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('insurance')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="insuranceFile" accept="image/*" onchange="window.handleFileSelect('insurance')">
                                <div id="insuranceStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="insuranceUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Permit Copy</label>
                                <div id="permitExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="permitLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Permit</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('permit')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="permitFile" accept="image/*" onchange="window.handleFileSelect('permit')">
                                <div id="permitStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="permitUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Fitness Copy</label>
                                <div id="fitnessExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="fitnessLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Fit.</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('fitness')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="fitnessFile" accept="image/*" onchange="window.handleFileSelect('fitness')">
                                <div id="fitnessStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="fitnessUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">PUC Copy</label>
                                <div id="pucExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="pucLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View PUC</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('puc')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="pucFile" accept="image/*" onchange="window.handleFileSelect('puc')">
                                <div id="pucStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="pucUrl">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveVehicleBtn">Save Vehicle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Expense Modal -->
    <div class="modal fade" id="vehicleExpenseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Vehicle Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicleExpenseForm">
                        <div class="mb-3">
                            <label class="form-label">Vehicle</label>
                            <select class="form-select" id="expenseVehicleSelect" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Expense Type</label>
                            <select class="form-select" id="expenseType">
                                <option value="Fuel">Fuel (Diesel/Petrol)</option>
                                <option value="Maintenance">Maintenance/Repair</option>
                                <option value="Insurance">Insurance Renewal</option>
                                <option value="Documents">Permits/Docs</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Amount (₹)</label>
                            <input type="number" class="form-control" id="expenseAmount" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Odometer (km/hrs)</label>
                            <input type="number" class="form-control" id="expenseOdometer">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="expenseDescription" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveExpenseBtn">Save Expense</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div class="modal fade" id="supplierModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierForm">
                        <div class="mb-3">
                            <label class="form-label">Supplier Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="supplierName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Supplier Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="supplierType" required>
                                <option value="">Select Type...</option>
                                <option value="Cement">Cement Supplier</option>
                                <option value="Dust/Sand">Dust / Sand Supplier</option>
                                <option value="Aggregate">Aggregate (Metal) Supplier</option>
                                <option value="Steel">Steel / Iron Supplier</option>
                                <option value="PVC/Fittings">PVC & Fittings</option>
                                <option value="Molds/Equipment">Molds & Equipment</option>
                                <option value="Logistics">Logistics / Transport</option>
                                <option value="General">General / Other</option>
                            </select>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Contact Person</label>
                                <input type="text" class="form-control" id="supplierContact">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="text" class="form-control" id="supplierPhone">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="supplierEmail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="supplierAddress" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">GSTIN</label>
                            <input type="text" class="form-control" id="supplierGstin">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveSupplierBtn">Save Supplier</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Payment Modal -->
    <div class="modal fade" id="supplierPaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment to Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierPaymentForm">
                        <input type="hidden" id="spId">
                        <input type="hidden" id="spName">
                        <div class="mb-3">
                            <label class="form-label">Supplier</label>
                            <input type="text" class="form-control" id="spNameDisplay" readonly>
                        </div>
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label">Date</label><input type="date" class="form-control" id="spDate" required></div>
                            <div class="col-6"><label class="form-label">Amount (₹)</label><input type="number" class="form-control" id="spAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label">Mode</label><select class="form-select" id="spMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label">Reference</label><input type="text" class="form-control" id="spRef" placeholder="Txn ID"></div>
                        </div>
                        <div class="mb-3 mt-2">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="spNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveSupplierPaymentBtn">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Ledger Modal -->
    <div class="modal fade" id="supplierLedgerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Supplier Ledger: <span id="slName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control form-control-sm" id="slStartDate">
                            <input type="date" class="form-control form-control-sm" id="slEndDate">
                            <button class="btn btn-sm btn-outline-primary" id="filterSupplierLedgerBtn">Filter</button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.printSupplierLedger()">
                                <i class="fas fa-print me-1"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered table-hover" id="supplierLedgerTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Description</th><th>Ref</th><th class="text-end">Purchase (Cr)</th><th class="text-end">Payment (Dr)</th><th class="text-end">Balance</th></tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot class="table-light fw-bold">
                                <tr><td colspan="3" class="text-end">Totals:</td><td class="text-end" id="slTotalPurchase">₹0</td><td class="text-end" id="slTotalPayment">₹0</td><td class="text-end" id="slFinalBalance">₹0</td></tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier History Modal -->
    <div class="modal fade" id="supplierHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Purchase History: <span id="historySupplierName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-sm" id="supplierHistoryTable">
                        <thead>
                            <tr><th>Date</th><th>Item</th><th>Qty</th><th>Cost</th><th>Invoice</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div class="modal fade" id="staffModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Staff Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="staffForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="staffName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mobile Number</label>
                            <input type="tel" class="form-control" id="staffMobile" placeholder="10 digit number" required>
                            <div class="form-text">This will be used for attendance login.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="staffRole">
                                <option value="Labour">Labour</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Driver">Driver</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Daily Wage (₹)</label>
                            <input type="number" class="form-control" id="staffWage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveStaffBtn">Save Staff</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Settings & QR Modal -->
    <div class="modal fade" id="attendanceSettingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Attendance Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="attendanceSettingsForm">
                        <div class="mb-3">
                            <label class="form-label">Allowed Check-in Start Time</label>
                            <input type="time" class="form-control" id="attStartTime">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Allowed Check-in End Time</label>
                            <input type="time" class="form-control" id="attEndTime">
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </div>
                    </form>
                    <hr>
                    <div class="text-center mt-4">
                        <h6>Attendance QR Code</h6>
                        <p class="small text-muted">Print this and stick it on your door.</p>
                        <div id="qrcode" class="d-flex justify-content-center my-3"></div>
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.printQR()">
                            <i class="fas fa-print me-1"></i> Print QR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Attendance Modal -->
    <div class="modal fade" id="manualAttendanceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manual Attendance Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="manualAttendanceForm">
                        <div class="mb-3">
                            <label class="form-label">Staff Member</label>
                            <select class="form-select" id="manualStaffSelect" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="manualDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Time</label>
                            <input type="time" class="form-control" id="manualTime" value="09:00">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="manualStatus">
                                <option value="Present">Full Day</option>
                                <option value="Half-Day">Half Day</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Wage for Day (₹)</label>
                            <input type="number" class="form-control" id="manualWage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveManualAttendanceBtn">Save Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div class="modal fade" id="teamMemberModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Team Member Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="teamMemberForm">
                        <input type="hidden" id="tmId">
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="tmEmail" required>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" id="tmFirstName" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="tmLastName" required>
                            </div>
                        </div>
                        <div class="mb-3" id="tmPasswordContainer">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="tmPassword" minlength="6">
                            <div class="form-text">Required for new members.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="tmRole">
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label d-block">Permissions</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="permDelete">
                                <label class="form-check-label" for="permDelete">Can Delete Items</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="permRevenue">
                                <label class="form-check-label" for="permRevenue">View Revenue</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTeamMemberBtn">Save Member</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Transaction Confirmation Modal -->
    <div class="modal fade" id="deleteTransactionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this transaction? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteTransactionBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Confirmation Modal -->
    <div class="modal fade" id="genericConfirmModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="genericConfirmTitle">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="genericConfirmMessage">Are you sure?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="genericConfirmBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Input Modal -->
    <div class="modal fade" id="genericInputModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="genericInputTitle">Enter Value</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label id="genericInputLabel" class="form-label"></label>
                    <input type="text" class="form-control" id="genericInputValue">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="genericInputBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal fade" id="imagePreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Document Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center bg-light">
                    <img id="previewImage" src="" class="img-fluid border rounded shadow-sm" style="max-height: 70vh;" alt="Preview">
                    <div class="mt-2 text-muted small" id="previewInfo"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Expiry Report Modal -->
    <div class="modal fade" id="expiryReportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Document Expiry Report (Next 30 Days)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle" id="expiryReportTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Document</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Renewed?</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" id="emailExpiryReportBtn">
                    <i class="fas fa-paper-plane me-1"></i>Email Report
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Premium Loader -->
    <div id="premiumLoader" class="premium-loader d-flex">
        <div class="loader-content">
            <div class="loader-box">
                <div class="spinner-ring ring-outer"></div>
                <div class="spinner-ring ring-inner"></div>
                <img src="logo.png" class="center-icon" alt="Logo" style="width: 50px; height: 50px; object-fit: contain;">
            </div>
            <h5 class="mt-3 fw-bold text-dark">PipePro</h5>
            <p class="text-muted small">Loading Business Data...</p>
        </div>
    </div>

    <style>
    .premium-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(8px);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    .loader-content {
        text-align: center;
        background: transparent;
        box-shadow: none;
        border: none;
        min-width: 250px;
    }
    .loader-box {
        position: relative;
        width: 80px;
        height: 80px;
        margin: 0 auto;
    }
    .spinner-ring {
        position: absolute;
        border-radius: 50%;
        border: 4px solid transparent;
    }
    .ring-outer {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-top-color: #0d6efd;
        border-bottom-color: #0d6efd;
        animation: spin 2s linear infinite;
    }
    .ring-inner {
        top: 15%;
        left: 15%;
        width: 70%;
        height: 70%;
        border-left-color: #0dcaf0;
        border-right-color: #0dcaf0;
        animation: spin-reverse 1.5s linear infinite;
    }
    .center-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes spin-reverse { 100% { transform: rotate(-360deg); } }

    /* Hero Logo Animation */
    .hero-logo-box {
        position: relative;
        width: 80px;
        height: 80px;
        margin-left: 15px;
    }
    .hero-spinner-ring {
        position: absolute;
        border-radius: 50%;
        border: 3px solid transparent;
    }
    .hero-ring-outer {
        top: 0; left: 0; width: 100%; height: 100%;
        border-top-color: rgba(255,255,255,0.9);
        border-bottom-color: rgba(255,255,255,0.9);
        animation: spin 3s linear infinite;
    }
    .hero-ring-inner {
        top: 15%; left: 15%; width: 70%; height: 70%;
        border-left-color: rgba(255,255,255,0.6);
        border-right-color: rgba(255,255,255,0.6);
        animation: spin-reverse 2s linear infinite;
    }
    .hero-center-icon {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 40px; height: 40px;
        background: white;
        border-radius: 50%;
        padding: 4px;
    }

    /* Pulse Animation */
    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
    .pulse-animation {
        animation: pulse-red 2s infinite;
    }

    /* Mobile Dashboard Enhancements */
    @media (max-width: 991.98px) {
        /* Combined Header & Hero */
        body.section-dashboard .navbar {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%) !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            box-shadow: none !important;
        }
        
        /* Standard Navbar for other sections */
        body:not(.section-dashboard) .navbar {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%) !important;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
        }

        /* Fix spacing for non-dashboard sections on mobile */
        body:not(.section-dashboard) main {
            padding-top: 0 !important;
            margin-top: 0 !important;
        }

        .navbar-brand, .navbar-brand span, .navbar-toggler {
            color: white !important;
        }
        .navbar-toggler {
            border-color: rgba(255,255,255,0.5) !important;
        }
        .navbar-toggler i {
            color: white !important;
        }
        #notificationBtn {
            background: rgba(255,255,255,0.2) !important;
            border: none !important;
            color: white !important;
        }
        #notificationBtn i {
            color: white !important;
        }
        
        #sidebarToggle i {
            color: white !important;
        }

        /* Mobile Hero */
        .mobile-hero-container {
            background: linear-gradient(-45deg, #4361ee, #3a0ca3, #4cc9f0, #4361ee);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            padding: 90px 20px 50px;
            border-radius: 0 0 30px 30px;
            margin: -1.5rem -1rem 20px -1rem; /* Full width and top alignment */
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }

        /* Premium Effects */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .mobile-hero-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-25deg);
            animation: shine 8s infinite;
        }
        @keyframes shine {
            0% { left: -100%; }
            20% { left: 200%; }
            100% { left: 200%; }
        }

        .mobile-hero-bg-icon {
            position: absolute;
            right: -20px;
            top: 10%;
            font-size: 12rem;
            opacity: 0.1;
            color: white;
            transform: rotate(-15deg);
        }

        /* Nav Grid */
        .nav-icon-box {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 12px 5px;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: transform 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .nav-icon-box:active {
            transform: scale(0.95);
        }
        .nav-icon-circle {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }
        .nav-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #4a5568;
            line-height: 1.1;
        }

        /* Compact Stats */
        .stat-card-mobile {
            border: none !important;
            border-radius: 16px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04) !important;
            background: white;
        }
        .stat-card-mobile .card-body {
            padding: 15px;
        }
        .stat-card-mobile .text-xs {
            font-size: 0.65rem;
            margin-bottom: 4px !important;
        }
        .stat-card-mobile .h5 {
            font-size: 1.1rem;
        }
    }
    </style>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jQuery & DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-remote-config-compat.js"></script>
    <!-- Firebase -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    <script type="module" src="js/inventory.js"></script>
    <script type="module" src="js/raw-materials.js"></script>
    <script type="module" src="js/customers.js"></script>
    <script type="module" src="js/projects.js"></script>
    <script type="module" src="js/invoices.js"></script>
    <script type="module" src="js/settings.js"></script>
    <script type="module" src="js/production.js"></script>
    <script type="module" src="js/profile.js"></script>
    <script type="module" src="js/vehicles.js"></script>
    <script type="module" src="js/suppliers.js"></script>
    <script type="module" src="js/staff.js"></script>
</body>
</html>
